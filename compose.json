{
  "version": "2.1",
  "networks": {
    "default": {
      "external": {
        "name": "ubuntu_default"
      }
    }
  },
  "services": {
    "admin": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.0"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:admin",
      "hostname": "admin"
    },
    "dnsmasq": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}",
        "5354:5353",
        "5354:5353/udp"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.99"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:dnsmasq",
      "hostname": "dnsmasq"
    },
    "consul": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.2"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:consul",
      "hostname": "consul"
    },
    "consul-ui": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.8"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:consul-ui",
      "hostname": "consul-ui"
    },
    "openvpn": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}",
        "1194:1194"
      ],
      "privileged": true,
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.3"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:openvpn",
      "hostname": "openvpn"
    },
    "squid": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}",
        "3128:3128"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.4"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:squid",
      "hostname": "squid"
    },
    "linkerd": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}",
        "80:4140",
        "1080:4140"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.7"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:linkerd",
      "hostname": "linkerd"
    },
    "etcd": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.15"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:etcd",
      "hostname": "etcd"
    },
    "app": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.11"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:app",
      "hostname": "app"
    },
    "buildkite": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.12"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:buildkite",
      "hostname": "buildkite"
    },
    "vault": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}",
        "8200:8200"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.13"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:vault",
      "hostname": "vault"
    },
    "postgresql": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.14"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:postgresql",
      "hostname": "postgresql"
    },
    "gogs": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.9"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:gogs",
      "hostname": "gogs"
    },
    "irssi": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.10"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:irssi",
      "hostname": "irssi"
    },
    "nexus": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}",
        "5001:5001"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.5"
        }
      },
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:nexus",
      "hostname": "nexus"
    },
    "nginx": {
      "volumes": [
        "/data:/data",
        "/config:/config"
      ],
      "ports": [
        "${BLOCK_SSH_PORT}",
        "80:8888"
      ],
      "cap_add": [
        "NET_ADMIN"
      ],
      "networks": {
        "default": {
          "ipv4_address": "${NET_PREFIX}.6"
        }
      },
      "dns": "172.28.128.1",
      "dns_search": "node.consul",
      "image": "${BLOCK_REGISTRY}/block:nginx",
      "hostname": "nginx"
    }
  }
}
